<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE chapter [
	<!ENTITY % extensions SYSTEM "../stylesheets/macros.ent" >
	<!ENTITY % DocBookDTD PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
	"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
	<!ENTITY % entities SYSTEM "../stylesheets/macros-en.ent" >
	%extensions;
	%DocBookDTD;
	%entities;
]>
<chapter id="mail::general">
  <title>Mail services</title>

  <section id="mail::introduction">
    <title>Introduction</title>
    <para>
	  &ucsUCS; provides mail services that users can access both via standard
	  mail clients such as Thunderbird and via the webmail interface Horde.
    </para>

    <para>
	  Postfix is used for sending and receiving mails. In the basic
	  installation, a configuration equipped for local mail delivery is set up
	  on every UCS system. In this configuration, Postfix only accepts mails
	  from the local server and they can also only be delivered to local system
	  users.
    </para>

    <para>
	  The installation of the mail server component implements a complete mail
	  transport via SMTP (see <xref linkend="mail::installation"/>).
	  Postfix is reconfigured during the installation of the component so that
	  a validity test in the form of a search in the LDAP directory is
	  performed for incoming e-mails. That means that e-mails are only accepted
	  for e-mail addresses defined in the LDAP directory or via an alias.
    </para>

    <para>
	  The IMAP service Dovecot is also installed on the system along with the mail
	  server component. It provides e-mail accounts for the domain users and
	  offers corresponding interfaces for access via e-mail clients.
	  Dovecot is preconfigured for the fetching of e-mails via <systemitem class="protocol">IMAP</systemitem> and <systemitem class="protocol">POP3</systemitem>.
	  Access via POP3 can be deactivated by setting the &ucsUCRV;
	  <envar>mail/dovecot/pop3</envar> to <literal>no</literal>. The same
	  applies to IMAP and the &ucsUCRV; <envar>mail/dovecot/imap</envar>.
	  The further configuration of the mail server is performed via &ucsUCR;,
	  as well (see <xref linkend="mail::serverconfig::general"/>).

		<note>
			<para>
				Since &ucsUCS; version 4.0-2 Dovecot is used as the default IMAP and
				POP3 server. Since &ucsUCS; version 4.3-0 the integration of Cyrus is
				not available anymore.
			</para>
		</note>
	</para>

    <para>
	  The management of the user data of the mail server (e.g., e-mail
	  addresses or mailing list) is performed via &ucsUMC; and is documented in
	  <xref linkend="mail::management::general"/> User data are stored in LDAP.
	  The authentication is performed using a user's primary e-mail address,
	  i.e., it must be entered as the user name in mail clients.
	  As soon as a primary e-mail address is assigned to a user in the LDAP
	  directory, a listener module creates an IMAP mailbox on the mail home
	  server.
	  By specifying the mail home server, user e-mail accounts can be
	  distributed over several mail servers, as well
	  (see <xref linkend="mail::homeserver"/>).
    </para>

    <para>
	  Optionally, e-mails received via Postfix can be checked for Spam content
	  and viruses before further processing by Dovecot.
	  Spam e-mails are detected by the classification software SpamAssassin
	  (<xref linkend="mail::spam"/>); ClamAV is used for the detection of
	  viruses and other malware (<xref linkend="mail::viren"/>).
    </para>

    <para>
	  In the default setting, e-mails to external domains are delivered
	  directly to the responsible SMTP server of that domain.
	  Its location is performed via the resolution of the MX record in the
	  DNS. Mail sending can also be taken over by the relay host, e.g., on the
	  Internet provider (see <xref linkend="mail::serverconfig::relay"/>).
    </para>

    <para>
	  The Horde framework is available for web-based mail access
	  (see <xref linkend="mail::horde"/>). The UCS mail system does not offer
	  any groupware functionality such as shared calendars or invitations to
	  appointments. However, there are groupware systems based on UCS which
	  integrate in the UCS management system such as Kolab, Zarafa and
	  Open-Xchange. Further information can be found in the Univention App Center
	  (see <xref linkend="software:appcenter"/>).
    </para>
  </section>

  <section id="mail::installation">
	<title>Installation</title>

	<para>
	  A mail server can be installed from the Univention App Center with the application
	  <emphasis>Mail server</emphasis>. Alternatively, the software package
	  <package>univention-mail-server</package> can be installed. Additional information can be found in
	  <xref linkend="computers::softwaremanagement::installsoftware"/>.
	  A mail server can be installed on all server system roles. The use of a
	  domain controller is recommended because of frequent LDAP accesses.
	</para>

	<para>
	  The runtime data of the Dovecot server are stored in the
	  <filename class="directory">/var/spool/dovecot/</filename> directory. If this directory
	  is on a NFS share, please read <xref linkend="mail::serverconfig::nfs"/>.
	</para>

	<para>
	  The webmail interface Horde can be installed via the Univention App Center (see <xref
	  linkend="software:appcenter"/>).
	</para>

  </section>

  <section id="mail::management::general">
	<title>Management of the mail server data</title>

	<section id="mail::management::domains">
	  <title>Management of mail domains</title>
	  <para>
		A mail domain is an common namespace for e-mail addresses, mailing
		lists and IMAP group folders. Postfix differentiates between the
		delivery of e-mails between local and external domains. Delivery to
		mailboxes defined in the LDAP directory is only conducted for e-mail
		address from local domains.
		The name of a mail domain may only be composed of lowercase letters,
		the figures 0-9, full stops and hyphens.
	  </para>
	  <para>
		Several mail domains can be managed with UCS. The managed mail domains
		do not need to be the DNS domains of the server - they can be
		selected at will.
		The mail domains registered on a mail server are automatically
		saved in the &ucsUCRV; <envar>mail/hosteddomains</envar>.
	  </para>
	  <para>
		To ensure that external senders can also send e-mails to members of
		the domain, MX records must be created in the configuration of the
		authoritative name servers, which designate the UCS server as mail
		server for the domain. These DNS adjustments are generally performed
		by an Internet provider.
	  </para>
	  <para>
		Mail domains are managed in the UMC module <emphasis>Mail</emphasis>
		with the <guimenu>Mail domain</guimenu> object type.
	  </para>
	</section>

	<section id="mail::management::users">
	  <title>Assignment of e-mail addresses to users</title>
	  <para>
		A user can be assigned three different types of e-mail addresses:
	  </para>
		<itemizedlist>
		  <listitem>
			<para>
			  The <emphasis>primary e-mail address</emphasis> is used for authentication on Postfix
			  and Dovecot. Primary e-mail addresses must always be unique. Only one primary e-mail
			  address can be configured for every user. It also defines the user's IMAP mailbox.
			  If a mail home server is assigned to a user (see <xref linkend="mail::homeserver"/>),
			  the IMAP inbox is automatically created by a Univention directory listener module.
			  The domain part of the e-mail address must be registered in &ucsUMC; (see
			  <xref linkend="mail::management::domains"/>).
			</para>
		  </listitem>
		  <listitem>
			<para>
			  E-mails to <emphasis>alternative e-mail addresses</emphasis> are also delivered to the
			  user's mailbox. As many addresses can be entered as you wish. The
			  alternative e-mail addresses do not have to be unique: if two users
			  have the same e-mail address, they both receive all the e-mails which
			  are sent to this address. The domain part of the
			  e-mail address must be registered in &ucsUMC; (see
			  <xref linkend="mail::management::domains"/>). To receive e-mails to alternative e-mail addresses,
				a user must have a primary e-mail address.
			</para>
		  </listitem>

		  <listitem>
		    <simpara>
		      If <emphasis>forward e-mail addresses</emphasis> are configured for a user,
		      e-mails received through the primary or alternative e-mail addresses are
		      forwarded to them. A copy of the messages can optionally be stored in the
		      user's mailbox. Forward e-mail addresses do not have to be unique and their
		      domain part does not have to be registered in &ucsUMC;.
		    </simpara>
		  </listitem>
		</itemizedlist>

		  <note>
		    <para>
		      E-mail addresses can consist of the following characters: letters a-z,
		      figures 0-9, dots, hyphens and underscores. The address has to begin
		      with a letter and must include an @ character.
		      At least one mail domain must be registered for to be able to
		      assign e-mail addresses (see <xref linkend="mail::management::domains"/>).
		    </para>
		  </note>

	  <para>
		E-mail addresses are managed in the UMC module <emphasis>Users</emphasis>.
		The <guimenu>primary e-mail address</guimenu> is entered in
		the <guimenu>General</guimenu> tab in the <guimenu>User account</guimenu>
		submenu.
		<guimenu>Alternative e-mail addresses</guimenu> can be entered
		under <guimenu>Advanced settings &ar; Mail</guimenu>.
	  </para>
	  <note>
		<para>
		Once the user account is properly configured authentication to the mail stack
		is possible (<systemitem class="service">IMAP</systemitem>/<systemitem class="service">POP3</systemitem>/<systemitem class="service">SMTP</systemitem>). Please keep in mind that after disabling the account
		or changing the password the login to the mail stack is still possible for 5min
		due to the authentication cache of the mail stack.
		To invalidate the authentication cache run
		<programlisting language="sh">
doveadm auth cache flush
		</programlisting>
		on the mail server. The expiration time of the authentication cache can be
		configured on the mail server with the &ucsUCRV;
		<envar>mail/dovecot/auth/cache_ttl</envar> and
		<envar>mail/dovecot/auth/cache_negative_ttl</envar>.
		</para>
	  </note>
	</section>

	<section id="mail::management::mailinglists">
	  <title>Management of mailing lists</title>
	  <para>
		Mailing lists are used to exchange e-mails in closed groups. Each
		mailing list has its own e-mail address. If an e-mail is sent to this
		address, it is received by all the members of the mailing list.
	  </para>
	  <para>
		<figure id="mail-mailinglist">
		  <title>Creating a mailing list</title>
		  <graphic scalefit="1" width="90%" align="center" fileref="illustrations43/mail_mailinglist_en.png"/>
		</figure>
	  </para>
	  <para>
		Mail domains are managed in the UMC module <emphasis>Mail</emphasis>
		with the <guimenu>Mailing list</guimenu> object type.
		A name of your choice can be entered for the mailing list
		under <guimenu>Name</guimenu>; the entry of a <guimenu>Description</guimenu>
		is optional.
		The e-mail address of the mailing list should be entered as
		the <guimenu>Mail address</guimenu>. The domain part of the address needs
		to be the same as one of the managed mail domains.
		As many addresses as necessary can be entered
		under <guimenu>Members</guimenu>. In contrast to mail groups (see
		<xref linkend="mail::management::mailgroups"/>), external e-mail
		addresses can also be added here.
		The mailing list is available immediately after its creation.
	  </para>
	  <para>
		In the default settings, everyone can write to the mailing list. To
		prevent misuse, there is the possibility of restricting the circle of
		people who can send mails. To do so,
		the &ucsUCRV; <envar>mail/postfix/policy/listfilter</envar> on the mail server must
		be set to <literal>yes</literal> and Postfix restarted.
		<guimenu>Users that are allowed to send e-mails to the list</guimenu>
		and <guimenu>Groups that are allowed to send e-mails to the list</guimenu>
		can be specified under <guimenu>Advanced settings</guimenu>. If a field is set
		here, only authorized users/groups are allowed to send mails.
	  </para>
	</section>

	<section id="mail::management::mailgroups">
	  <title>Management of mail groups</title>
	  <para>
		There is the possibility of creating a mail group: This is where an
		e-mail address is assigned to a group of users. E-mails to this address are
		delivered to the primary e-mail address of each of the group members.
	  </para>
	  <para>
		Mail groups are managed in the UMC module <emphasis>Groups</emphasis>
		(see <xref linkend="groups"/>).
	  </para>
	  <para>
		The e-mail address of the mail group is specified in
		the <guimenu>mail address</guimenu> input field
		under <guimenu>Advanced settings</guimenu>. The domain part of the address
		must be the same as one of the managed mail domains.
	  </para>
	  <para>
		In the default settings, everyone can write to the mail group. To
		prevent misuse, there is the possibility of restricting the circle of
		people who can send mails. To do so,
		the &ucsUCRV; <envar>mail/postfix/policy/listfilter</envar> on the mail server must
		be set to <literal>yes</literal> and Postfix restarted.
	  </para>
	  <para>
		<guimenu>Users that are allowed to send e-mails to the group</guimenu>
		and <guimenu>Groups that are allowed to send e-mails to the group</guimenu> can be specified
		under <guimenu>Advanced settings</guimenu>. If a field is set here,
		only authorized users/groups are allowed to send mails.
	  </para>
	</section>

	<section id="mail::management::sharedfolder">
	  <title>Management of shared IMAP folders</title>
	  <para>
		Shared e-mail access forms the basis for cooperation in many work
		groups. In UCS, users can easily create folders in their own mailboxes
		and assign permissions so that other users may read e-mails in these
		folders or save additional e-mails in them.
	  </para>
	  <para>
		Alternatively, individual IMAP folders can be shared for users or user
		groups. This type of folder is described as a shared IMAP folder.
		Shared IMAP folders are managed in the UMC module <emphasis>Mail</emphasis>
		with the <guimenu>Mail folder (IMAP)</guimenu> object type.
	  </para>

		<para>
			Shared folders cannot be renamed, therefore the &ucsUCRV;
			<envar>mail/dovecot/mailbox/rename</envar> is not taken into account. When a shared
			folder is deleted in the UMC module <emphasis>Mail</emphasis>, it is
			only deleted from the hard disk, if
			<envar>mail/dovecot/mailbox/delete</envar> is set to <literal>yes</literal>. The default value is <literal>no</literal>.
		</para>

	  <para>
		<figure id="mail-sharedfolder">
		  <title>Creating a shared IMAP folder</title>
		  <graphic scalefit="1" width="100%" fileref="illustrations43/mail_imapfolder_en.png"/>
		</figure>
	  </para>

	  <table>
		<title>'General' tab</title>
		<tgroup cols="2">
		  <colspec colnum="1" colname="col1" colwidth="1*"/>
		  <colspec colnum="2" colname="col2" colwidth="2*"/>
		  <thead>
			<row>
			  <entry>Attribute</entry>
			  <entry>Description</entry>
			</row>
		  </thead>
		  <tbody>

			<row>
			  <entry>Name (*)</entry>
			  <entry>
				The name under which the IMAP folder is available in the e-mail
				clients. The name displayed in the IMAP client differs
				depending on if an e-mail address is configured (see row
				"E-Mail address" below) or not. If no e-mail address is
				configured, the IMAP folder will be displayed in the
				client as <literal>name@domain/INBOX</literal>. If an e-mail
				address is configured, it will be <literal>shared/name@domain</literal>.
			  </entry>
			</row>

			<row>
			  <entry>Mail domain (*)</entry>
			  <entry>
				Every shared IMAP folder is assigned to a mail domain. The management
				of the domains is documented in the <xref linkend="mail::management::domains"/>.
			  </entry>
			</row>

			<row>
			  <entry>Mail home server (*)</entry>
			  <entry>
				An IMAP folder is assigned to a mail home server. Further information
				can be found in <xref linkend="mail::homeserver"/>.
			  </entry>
			</row>

			<row>
			  <entry>Quota in MB</entry>
			  <entry>
				This setting can be used to set the maximum total size of all e-mails
				in this folder.
			  </entry>
			</row>

			<row>
			  <entry>E-Mail address</entry>
			  <entry>
				<para>
				  An e-mail address can be entered here via which e-mails can be sent
				  directly to the IMAP folder. If no address is set here, it is only
				  possible to write in the folder from e-mail clients.
				</para>
				<para>
				  The domain part of the e-mail address must be registered in &ucsUMC; (see
				  <xref linkend="mail::management::domains"/>).
				</para>
			  </entry>
			</row>
		  </tbody>
		</tgroup>
	  </table>

	  <table>
		<title>'Access rights' tab</title>
		<tgroup cols="2">
		  <colspec colnum="1" colname="col1" colwidth="1*"/>
		  <colspec colnum="2" colname="col2" colwidth="2*"/>
		  <thead>
			<row>
			  <entry>Attribute</entry>
			  <entry>Description</entry>
			</row>
		  </thead>
		  <tbody>

			<row>
			  <entry>Name (*)</entry>
			  <entry>
				<para>
				  Access permissions based on users or groups can be entered
				  here. Users are entered with their user name; the groups saved
				  in &ucsUMC; can be used as groups.
				</para>
				<para>
				  The access permissions have the following consequences for individual
				  users or members of the specified group:
				</para>
				<variablelist>
					<varlistentry>
						<term>No access</term>
						<listitem>
							<simpara>
							No access is possible. The folder is not displayed in the folder list.
							</simpara>
						</listitem>
					</varlistentry>
					<varlistentry>
						<term>Read</term>
						<listitem>
							<simpara>
							The user may only perform read access to existing entries.
							</simpara>
						</listitem>
					</varlistentry>
					<varlistentry>
						<term>Append</term>
						<listitem>
							<simpara>
							Existing entries may not be edited; only new entries may be created.
							</simpara>
						</listitem>
					</varlistentry>
					<varlistentry>
						<term>Write</term>
						<listitem>
							<simpara>
							New entries may be created in this directory;
							existing entries may be edited or deleted.
							</simpara>
						</listitem>
					</varlistentry>
					<varlistentry>
						<term>Post</term>
						<listitem>
							<simpara>
							Sending an e-mail to this directory as a
							recipient is permitted. This function is not supported by all the clients.
							</simpara>
						</listitem>
					</varlistentry>
					<varlistentry>
						<term>All</term>
						<listitem>
							<simpara>
							Encompasses all permissions of
							<emphasis>write</emphasis> and also allows the changing of access permissions.
							</simpara>
						</listitem>
					</varlistentry>
				</variablelist>
			  </entry>
			</row>
		  </tbody>
		</tgroup>
	  </table>
	</section>

	<section id="mail:Mail_quota">
	  <title>Mail quota</title>
	  <para>
		The size of the users' mailboxes can be restricted via the mail
		quota. When this is attained, no further e-mails can be accepted for
		the mailbox by the mail server until the user deletes old mails from
		her account.
	  </para>
		<para>
			The limit is specified in megabytes in the <guimenu>Mail quota</guimenu> field
			under <guimenu>Advanced settings &ar; Mail</guimenu>. The default value
			is <literal>0</literal> and means that no limit is set.
			The multi edit mode of &ucsUMC; can be used to assign a quota to multiple
			users at one time, see <xref linkend="central:user-interface:edit"/>.
		</para>
		<para>
		The user can be warned once a specified portion of the mailbox is
		attained and then receives a message that his
		available storage space is almost full.
		The administrator can enter the threshold in percent and the messages
		subject and text:
		<itemizedlist>
			<listitem>
				<para>
					The threshold for when the warning message should be issued can
					be configured in the &ucsUCRV;
					<envar>mail/dovecot/quota/warning/text/PERCENT=TEXT</envar>.
					<literal>PERCENT</literal> must be a number between 0 and 100 without the percent
					sign, TEXT will be the content of the e-mail.
				</para>
				<para>
					If <literal>TEXT</literal> contains the string <literal>$PERCENT</literal>, it will be replaced in
					the email with the value of the limit that has been exceeded.
				</para>
				<para>
					The value of the &ucsUCRV; <envar>mail/dovecot/quota/warning/subject</envar>
					will be used for the subject of the e-mail.
				</para>
			</listitem>
		  <listitem>
				<para>
					When the mail server package is installed, a subject and
					two warning messages are automatically configured:
					<itemizedlist>
						<listitem>
							<para>
								<envar>mail/dovecot/quota/warning/subject</envar> is set to <literal>Quota-Warning</literal>
							</para>
						</listitem>
						<listitem>
							<para>
								<envar>mail/dovecot/quota/warning/text/80</envar> is set to <literal>Your mailbox has filled up to over $PERCENT%.</literal>
							</para>
						</listitem>
						<listitem>
							<para>
								<envar>mail/dovecot/quota/warning/text/95</envar> is set to <literal>Attention: Your mailbox has already filled up to over $PERCENT%. Please delete some messages or contact the administrator.</literal>
							</para>
						</listitem>
					</itemizedlist>
				</para>
			</listitem>
		</itemizedlist>
	  </para>
	</section>
  </section>

  <section id="mail::spam">
	<title>Spam detection and filtering</title>
	<para>
	  Undesirable and unsolicited e-mails are designated as Spam. The software
	  SpamAssassin and Postgrey are integrated in UCS for the automatic identification of these
	  e-mails. SpamAssassin attempts to identify whether an e-mail is desirable or
	  not based on heuristics concerning its origin, form and content.
	  Postgrey is a policy server for Postfix, which implements gray listing.
	  Grey listing is a Spam detection method which denies the first delivery attempt of external mail servers.
	  Mail servers of Spam senders most often do not perform a second delivery attempt, while legitimate servers do so.
	  Integration occurs via the packages <package>univention-spamassassin</package> and <package>univention-postgrey</package>,
	  which are automatically set up during the installation of the mail
	  server package.
	</para>
	<para>
	  SpamAssassin operates a point system, which uses an increasing number
	  of points to express a high probability of the e-mail being
	  Spam. Points are awarded according to different criteria, for example,
	  keywords within the e-mail or incorrect encodings.
	  In the standard configuration only mails with a size of up to 300 kilobytes
	  are scanned, this can be adjusted using
	  the &ucsUCRV; <envar>mail/antispam/bodysizelimit</envar>.
	  E-mails which are classified as Spam - because they exceed a certain
	  number of points - are not delivered to the recipient's inbox by
	  Dovecot, but rather in the <emphasis>Spam</emphasis> folder below it.
	  The name of the folder for Spam can be configured with the &ucsUCRV;
	  <envar>mail/dovecot/folder/Spam</envar>.
	  The filtering is performed by a Sieve script, which is automatically generated when
	  the user is created.
	</para>
	<para>
	  The threshold in these scripts as of which e-mails are declared to be Spam can be
	  configured with the &ucsUCRV; <envar>mail/antispam/requiredhits</envar>.
	  The presetting (<literal>5</literal>) generally does not need to be adjusted.
	  However, depending on experience in the local environment, this
	  value can also be set lower. This will, however, result in more
	  e-mails being incorrectly designated as Spam.
	  Changes to the threshold do not apply to existing users, but the users
	  can change the value themselves in the Horde web client (see
	  <xref linkend="mail::horde::filter"/>).
	</para>
	<para>
	  There is also the possibility of evaluating e-mails with a Bayes
	  classifier. This compares an incoming e-mail with statistical data
	  already gathered from processed e-mails and uses this to adapt it's
	  evaluation to the user's e-mail.
	  The Bayes classification is controlled by the user himself, whereby
	  e-mails not identified as Spam by the system can be placed in the <emphasis>Spam</emphasis>
	  subfolder by the user and a selection of legitimate e-mails copied into
	  the <emphasis>Ham</emphasis> (<envar>mail/dovecot/folder/ham</envar>) subfolder. This folder is evaluated daily and data
	  which have not yet been collected or were previously classified
	  incorrectly are collected in a shared database. This evaluation is
	  activated in the default setting and can be configured with
	  the &ucsUCRV; <envar>mail/antispam/learndaily</envar>.
	</para>
	<para>
	  The Spam filtering can be deactivated by setting
	  the &ucsUCRV; <envar>mail/antivir/spam</envar> to <literal>no</literal>.
	  When modifying Univention Configuration Registry variables concerning Spam
	  detection, the AMaViS service and Postfix must be restarted subsequently.
	</para>
  </section>

  <section id="mail::viren">
	<title>Identification of viruses and malware</title>
	<para>
	  The UCS mail services include virus and malware detection via
	  the <package>univention-antivir-mail</package> package, which is automatically
	  set up during the set up of the mail server package. The virus scan
	  can be deactivated with the &ucsUCRV; <envar>mail/antivir</envar>.
	</para>
	<para>
	  All incoming and outgoing e-mails are scanned for viruses. If the
	  scanner recognizes a virus, the e-mail is sent to
	  quarantine. That means that the e-mail is stored on the server where
	  it is not accessible to the user. The original recipient receives a
	  message per e-mail stating that this measure has been taken. If
	  necessary, the administrator can restore or delete this from
	  the <filename class="directory">/var/lib/amavis/virusmails/</filename> directory. Automatic deletion
	  is not performed.
	</para>
	<para>
	  The <application>AMaViSd-new</application> software serves as an interface between the mail server and
	  different virus scanners. The free virus scanner ClamAV is included in
	  the package and enters operation immediately after installation. The
	  signatures required for virus identification are procured and updated
	  automatically and free of charge by the Freshclam service.
	</para>
	<para>
	  Alternatively or in addition, other virus scanners can also be integrated
	  in AMaViS.
	  Postfix and AMaViS need to be restarted following changes to the
	  AMaViS or ClamAV configuration.
	</para>
  </section>

	<section id="mail::dnsbl">
		<title>Identification of Spam sources with <foreignphrase>DNS-based Blackhole Lists</foreignphrase> (DNSBL)</title>
		<para>
			Another means of combating Spam is to use a <foreignphrase>DNS-based Blackhole List</foreignphrase>
			(<acronym>DNSBL</acronym>) or <foreignphrase>Real-time Blackhole List</foreignphrase> (<acronym>RBL</acronym>).
			DNSBLs are lists of IP addresses that the operator believes to be (potential) sources of Spam.
			The lists are checked by DNS.
			If the IP of the sending e-mail server is known to the DNS server, the message is rejected.
			The IP address is checked quickly and in a comparatively resource-friendly manner.
			The check is performed <emphasis>before</emphasis> the message is accepted.
			The extensive checking of the content with SpamAssassin and anti-virus software is only performed once it has been received. Postfix has integrated support for DNSBLs
			(<ulink url="http://www.postfix.org/postconf.5.html#reject_rbl_client"/>).
		</para>
		<para>
			DNSBLs from various projects and companies are available on the Internet.
			Please refer to the corresponding websites for further information on conditions and prices.
		</para>
		<para>
			The &ucsUCRV; <envar>mail/postfix/smtpd/restrictions/recipient/<replaceable>SEQUENCE</replaceable>=<replaceable>RULE</replaceable></envar> must be set to be able to use DNSBLs with Postfix.
			It can be used to configure recipient restrictions via the Postfix option <property>smtpd_recipient_restrictions</property> (see <ulink url="http://www.postfix.org/postconf.5.html#smtpd_recipient_restrictions"/>).
			The sequential number is used to sort multiple rules alphanumerically, which can be used to influences the ordering.
		</para>
		<tip>
			<para>
				Existing <property>smtpd_recipient_restrictions</property> regulations can be listed as follows:
				<programlisting language="sh">ucr search --brief mail/postfix/smtpd/restrictions/recipient</programlisting>
			</para>
		</tip>
		<para>
			In an unmodified &ucsUCS; Postfix installation, the DNSBL should be added to the end of the <property>smtpd_recipient_restrictions</property> rules.
			For example:
			<programlisting language="sh">ucr set mail/postfix/smtpd/restrictions/recipient/80="reject_rbl_client ix.dnsbl.manitu.net"</programlisting>
		</para>
	</section>

  <section id="mail::fetchmail">
	<title>Integration of Fetchmail for retrieving mail from external mailboxes</title>
	<para>
	  Usually, the UCS mail service accepts mails for the users of the UCS domain directly via
	  SMTP. UCS also offers optional integration of the software Fetchmail for fetching emails from
	  external POP3 or IMAP mailboxes.
	</para>

	<para>
	  Fetchmail can be installed via the Univention App Center; simply select the
	  <guimenu>Fetchmail</guimenu> application and then click on <guimenu>Install</guimenu>.
	</para>

	<para>
	  Once the installation is finished, there are additional input fields in the
	  <guimenu>Advanced settings &ar; Remote mail retrieval</guimenu> tab of the user
	  administration which can be used to configure the collection of mails from an external
	  server. The mails are delivered to the inboxes of the respective users (the primary e-mail
	  address must be configured for that).
    </para>
	<para>
	  The mail is fetched every twenty minutes once at least one e-mail address is configured for
	  mail retrieval. After the initial configuration of a user Fetchmail needs to be started in the
	  UMC module <guimenu>System services</guimenu>. In that module the fetching can
	  also be disabled (alternatively by setting the &ucsUCRV; <envar>fetchmail/autostart</envar>
	  to <literal>false</literal>).
	</para>
	  <table>
		<title>'Remote mail retrieval' tab'</title>
		<tgroup cols="2">
			<colspec colnum="1" colname="col1" colwidth="1*"/>
			<colspec colnum="2" colname="col2" colwidth="2*"/>
			<thead>
			  <row>
				<entry>Attribute</entry>
				<entry>Description</entry>
			  </row>
			</thead>
			<tbody>

			  <row>
				<entry>Username</entry>
				<entry>The user name to be provided to the mail server for fetching mail.</entry>
			  </row>

			  <row>
				<entry>Password</entry>
				<entry>The password to be used for fetching mail.</entry>
			  </row>

			  <row>
				<entry>Protocol</entry>
				<entry>The mail can be fetched via the IMAP or POP3 protocols.</entry>
			  </row>

			  <row>
				<entry>Remote mail server</entry>
				<entry>The name of the mail server from which the e-mails are to be fetched.</entry>
			  </row>

			  <row>
				<entry>Encrypt connection (SSL/TLS)</entry>
				<entry>If this option is enabled, the mail is fetched in an encrypted form (when
				this is supported by the mail server).</entry>
			  </row>

			  <row>
				<entry>Keep mails on the server</entry>
				<entry>In the default settings, the fetched mails are deleted from the server
				following the transfer. If this option is enabled, it can be suppressed.</entry>
			  </row>

			</tbody>
		  </tgroup>
		</table>
  </section>

  <section id="mail::serverconfig::general">
	<title>Configuration of the mail server</title>

	<section id="mail::serverconfig::relay">
	  <title>Configuration of a relay host for sending the e-mails</title>

	  <para>
		In the default setting, Postfix creates a direct SMTP connection to
		the mail server responsible for the domain when an e-mail is sent to
		a non-local address. This server is determined by querying the MX
		record in the DNS.
	  </para>
	  <para>
		Alternatively, a mail relay server can also be used, i.e., a server
		which receives the mails and takes over their further sending. This
		type of mail relay server can be provided by a superordinate corporate
		headquarters or the Internet provider, for example. To set a relay
		host, it must be entered as a fully qualified domain name (FQDN) in
		the &ucsUCRV; <envar>mail/relayhost</envar>.
	  </para>
	  <para>
		If authentication is necessary on the relay host for sending,
		the &ucsUCRV; <envar>mail/relayauth</envar> must be set to <literal>yes</literal> and
		the <filename>/etc/postfix/smtp_auth</filename> file edited. The relay host,
		user name and password must be saved in this file in one line.
	  </para>
		<programlisting>
<replaceable>FQDN-Relayhost</replaceable>	<replaceable>username</replaceable>:<replaceable>password</replaceable>
		</programlisting>
	  <para>
		The command
	  </para>
		<programlisting language="sh">
postmap /etc/postfix/smtp_auth
		</programlisting>
	  <para>
		must then be executed for this file to adopt the changes via Postfix.
	  </para>
	  <note>
		  <para>
			  To ensure an encrypted connection while using a relay host, the Postfix option
			  <literal>smtp_tls_security_level=encrypt</literal> has to be set. &ucsUCS; will
			  set this option automatically, if <envar>mail/relayhost</envar> is set and
			  <envar>mail/relayauth</envar> is set to <literal>yes</literal> and
			  <envar>mail/postfix/tls/client/level</envar> is not set to <literal>none</literal>.
		  </para>
	  </note>
	</section>

	<section id="mail::serverconfig::mailsize">
	  <title>Configuration of the maximum mail size</title>

	  <para>
		The &ucsUCRV; <envar>mail/messagesizelimit</envar> can be used to set the maximum
		size in bytes for incoming and outgoing e-mails. Postfix must be restarted after modifying the setting.
		The preset maximum size is 10240000 bytes. If the value is configured to
		<literal>0</literal> the limit is effectively removed.
		Please note that e-mail attachments are enlarged by approximately a third due to the base64
		encoding.
	  </para>

	  <para>
		If Horde (see <xref linkend="mail::horde"/>) is used, the &ucsUCR; variables
		<envar>php/limit/filesize</envar> and <envar>php/limit/postsize</envar> must also be
		adjusted. The maximum size in megabytes must be entered as the value in both variables. Then
		the Apache web server has to be restarted.
	  </para>

	</section>

	<section id="mail::serverconfig::archivefolder">
	  <title>Configuration of a blind carbon copy for mail archiving solutions</title>

	  <para>
		If the &ucsUCRV; <envar>mail/archivefolder</envar> is set to an e-mail address,
		Postfix sends a blind carbon copy of all incoming and outgoing e-mails to
		this address. This results in an archiving of all e-mails. The e-mail
		address must already exist. It can be either one already registered in
		&ucsUCS; as the e-mail address of a user, or an e-mail account with
		an external e-mail service. As standard the variable is not set.
	  </para>
	  <para>
		Postfix must then be restarted.
	  </para>
	</section>

	<section id="mail::serverconfig::softbounce">
	  <title>Configuration of soft bounces</title>
	  <para>
		If a number of error situations (e.g., for non-existent users) the
		result may be a mail bounce, i.e., the mail cannot be delivered and is
		returned to the sender. When &ucsUCRV; <envar>mail/postfix/softbounce</envar> is set
		to <literal>yes</literal> e-mails are never returned after a bounce, but instead
		are held in the queue. This setting is particularly useful during
		configuration work on the mail server.
	  </para>
	</section>

	<section id="mail::serverconfig::smtpports">
		<title>Configuration of SMTP ports</title>
		<para>
			On a &ucsUCS; mail server Postfix is configured to listen for connections
			on three ports:
		</para>
		<itemizedlist>
			<listitem>
				<para>
					Port 25 (<systemitem class="service">SMTP</systemitem>) should be
					used by other mail servers only. By default authentication is disabled.
					If submission of emails from users is desired on port 25,
					authentication can be enabled by setting the &ucsUCRV;
					<envar>mail/postfix/mastercf/options/smtp/smtpd_sasl_auth_enable=yes</envar>.
				</para>
			</listitem>
			<listitem>
				<para>
					Port 465 (<systemitem class="service">SMTPS</systemitem>) allows
					authentication and email submission through a SSL encrypted connection.
					<systemitem class="service">SMTPS</systemitem> has been declared
					deprecated in favor of port 587 but is kept enabled for legacy clients.
				</para>
			</listitem>
			<listitem>
				<para>
					Port 587 (<systemitem class="service">Submission</systemitem>) allows
					authentication and email submission through a TLS encrypted connection.
					The use of STARTTLS is enforced.
				</para>
			</listitem>
		</itemizedlist>
		<para>
			The Submission port should be preferred by email clients. The use of the ports
			25 and 465 for email submission is deprecated.
		</para>
	</section>

	<section id="mail::serverconfig::postscreen">
		<title>Configuration of additional checks by <application>postscreen</application></title>
		<para>
			When using a mail server that is directly accessible from the Internet, there is always a risk
			that Spam sender, Spam bots or broken mail servers are continually trying to deliver unwanted emails
			(for example Spam) to the UCS system.
		</para>
		<para>
			To reduce the load of the mail server for such cases, Postfix brings its own service with the name
			<application>postscreen</application>, which is put in front of Postfix and accepts incoming SMTP
			connections. On these incoming SMTP connections, some lightweight tests are first performed.
			If the result is positive, the respective connection is passed on to Postfix. Otherwise the SMTP
			connection is terminated and thus the incoming mail is rejected before being in the area of ​​responsibility
			of the UCS mail server.
		</para>
		<para>
			By default, <application>postscreen</application> is not active. By setting the &ucsUCRV; <envar>mail/postfix/postscreen/enabled</envar>
			to the value <literal>yes</literal>, <application>postscreen</application> can be activated.
		</para>
		<para>
			Various UCR variables with the prefix <envar>mail/postfix/postscreen/</envar> can be used to configure <application>postscreen</application>.
			A list of all relevant UCR variables including descriptions can be retrieved e.g. on command line via the command
			<command>ucr search --verbose mail/postfix/postscreen/</command>.
		</para>
		<note>
			<para>
				After each change of a UCR variable for <application>postscreen</application> the configuration of Postfix and <application>postscreen</application> should
				be reloaded. This can be triggered e.g. via the command  <command>service postfix reload</command>.
			</para>
		</note>
	</section>

	<section id="mail::serverconfig::sender_check">
		<title>Configuration to prevent forged From addresses</title>
		<para>
			In the default configuration <application>Postfix</application> allows authenticated users to send with an
			arbitrary <literal>From</literal> address.
			It also allows non-authenticated users to deliver emails to the	system with a <literal>From</literal>
			of a domain that is hosted on the system itself.
		</para>
		<para>
			A filter can be enabled, that will prevent the forging of <literal>From</literal> addresses in both cases.
			The filter (technically called a <application>milter</application>) will reject such emails during the SMTP
			dialogue, so that they won't even reach the spam filter.
			The filter will log rejects to the usual mail log file (<filename>/var/log/mail.log</filename>).
			To enable the <application>sender_check milter</application>, <application>Postfix</application> must be
			configured to connect to it.
		</para>
		<para>
			<application>Postfix</application> supports using multiple <application>milters</application> at once, so
			its <envar>milters</envar> configuration allows multiple entries. To make those sortable the &ucsUCRV; is
			<envar>mail/postfix/smtpd_milters/<replaceable>SEQUENCE</replaceable>=<replaceable>ADDRESS</replaceable></envar>.
		</para>
		<para>
			The <application>sender_check milter</application> is a small program that listens by default on port <envar>5656</envar> on <envar>localhost</envar>. The port can be changed using the &ucsUCRV;
			<envar>mail/postfix/sender_check_milter_port</envar>.
		</para>
		<note>
			<para>
				After each change of a <application>Postfix</application> related &ucsUCRV;, reload
				<application>Postfix</application>: <command>service postfix reload</command>.
			</para>
		</note>
	</section>

	<section id="mail::serverconfig::maincflocal">
		<title>Custom Postfix configuration</title>
		<para>
			It is possible to modify the Postfix configuration, that resides within the file <filename>/etc/postfix/main.cf</filename>, beyond the variables that can be set with &ucsUCRV;.
		</para>
		<para>
			If the file <filename>/etc/postfix/main.cf.local</filename> exists, its content will be appended to the file <filename>main.cf</filename>. To transfer changes of <filename>main.cf.local</filename> to <filename>main.cf</filename>, the following command must be executed:
			<programlisting language="sh">
ucr commit /etc/postfix/main.cf
			</programlisting>
			For the Postfix service to accept the changes, it must be reloaded:
			<programlisting language="sh">
service postfix reload
			</programlisting>
		</para>
		<para>
			If a Postfix variable that has previously been set in <filename>main.cf</filename> is set again in <filename>main.cf.local</filename>, Postfix will issue a warning to the log file <filename>/var/log/mail.log</filename>.
		</para>
		<note>
			<para>
				If Postfix' behavior is not as expected, first remove configuration settings made by <filename>main.cf.local</filename>. Rename the file or comment out its content. Next run the two commands above. The configuration will then return to UCS defaults.
			</para>
		</note>
	</section>

	<section id="mail::renamedusers">
	  <title>Handling of mailboxes during e-mail changes and the deletion of user accounts</title>
	  <para>
		A user's mailbox is linked to the primary e-mail address and not to
		the user name. The &ucsUCRV; <envar>mail/dovecot/mailbox/rename</envar> can be used to
		configure the reaction when the primary e-mail address is changed:
	  </para>
		<itemizedlist>
		  <listitem>
			<para>
			  If the variable is set to <literal>yes</literal>, the name of
			  the user's IMAP mailbox is changed. This is the standard setting since UCS 3.0.
			</para>
		  </listitem>
		  <listitem>
			<para>
			  If the setting is <literal>no</literal>, it will not be
			  possible to read previous e-mails any more once the user's primary e-mail
			  address is changed! If another user is assigned a previously used primary
			  e-mail address, she receives access to the old IMAP structure of this mailbox.
			</para>
		  </listitem>
		</itemizedlist>
	  <para>
		The &ucsUCRV; <envar>mail/dovecot/mailbox/delete</envar> can be used to configure, whether
		the IMAP mailbox is also deleted. The value <literal>yes</literal> activates the removal of the corresponding IMAP mailbox if one of the following actions is performed:
		<itemizedlist>
			<listitem>
				<simpara>
					deletion of the user account
				</simpara>
			</listitem>
			<listitem>
				<simpara>
					removal of the primary e-mail address from the user account
				</simpara>
			</listitem>
			<listitem>
				<simpara>
					changing the user's mail home server to a different system
				</simpara>
			</listitem>
		</itemizedlist>
		With default settings (<literal>no</literal>) the mailboxes are kept if one of the actions above is performed.
	  </para>

	<para>
		The combination of the two variables creates four possible outcomes when the e-mail address is changed:
		<table>
			<title>Renaming of e-mail addresses</title>
			<tgroup cols="2">
				<colspec colnum="1" colname="col1" colwidth="1*"/>
				<colspec colnum="2" colname="col2" colwidth="2*"/>
				<thead>
					<row>
						<entry><envar>mail/dovecot/mailbox/…</envar></entry>
						<entry>Meaning</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>
							<literal>rename=yes</literal> and <literal>delete=no</literal> (Default)
						</entry>
						<entry>The existing mailbox will be renamed. E-mails will be preserved
							and will be accessible at the new address.
						</entry>
					</row>
					<row>
						<entry>
							<literal>rename=yes</literal> and <literal>delete=yes</literal>
						</entry>
						<entry>The existing mailbox will be renamed. E-mails will be preserved
							and will be accessible at the new address.
						</entry>
					</row>
					<row>
						<entry>
							<literal>rename=no</literal> and <literal>delete=no</literal>
						</entry>
						<entry>A new, empty mailbox will be created. The old one will be
							preserved on disk with the old name and will thus not be
							accessible to users.
						</entry>
					</row>
					<row>
						<entry>
							<literal>rename=no</literal> and <literal>delete=yes</literal>
						</entry>
						<entry>A new, empty mailbox will be created. The old one will be
							deleted from the hard disk.
						</entry>
					</row>
				</tbody>
			</tgroup>
		</table>
	</para>
	</section>

	<section id="mail::homeserver">
	  <title>Distribution of an installation on several mail servers</title>
	  <para>
		The UCS mail system offers the possibility of distributing users across
		several mail servers. To this end, each user is assigned a so-called mail home
		server on which the user's mail data are stored. When delivering an e-mail, the
		responsible home server is automatically determined from the LDAP directory.
	  </para>
	  <para>
		It must be observed that global IMAP folders (see <xref
		linkend="mail::management::sharedfolder"/>) are assigned to a mail home server.
	  </para>
	  <para>
		If the mail home server is changes for a user, the user's mail data is <emphasis>not</emphasis> moved to the server automatically.
	  </para>
	</section>

	<section id="mail::serverconfig::nfs">
		<title>Mail storage on NFS</title>
		<para>
			Dovecot supports storing e-mails and index files on cluster filesystems
			and on NFS. Some settings are necessary to prevent data loss in certain
			situations.
		</para>
		<para>
			The following settings assume that mailboxes are not accessed simultaneously
			by multiple servers. This is the case if for each user exactly
			one mail home server has been configured.
		</para>
		<para>
			<itemizedlist>
				<listitem><simpara><envar>mail/dovecot/process/mmap_disable</envar><literal> = yes</literal></simpara></listitem>
				<listitem><simpara><envar>mail/dovecot/process/dotlock_use_excl</envar><literal> = yes</literal></simpara></listitem>
				<listitem><simpara><envar>mail/dovecot/process/mail_fsync</envar><literal> = always</literal></simpara></listitem>
			</itemizedlist>
		</para>
		<para>
			To achieve higher performance, index files can be kept on the local servers
			disk, instead of storing them together with the messages on NFS. The index
			files can then be found at <filename class="directory">/var/lib/dovecot/index/</filename>.
			To activate this option, set &ucsUCRV;
			<envar>mail/dovecot/location/separate_index</envar><literal> = yes</literal>.
		</para>
		<para>
			With the above settings the mail server should work without problems on
			NFS. There are however a lot of different client and server systems in
			service. In case you encounter problems, here are some notes that might
			help:
			<itemizedlist>
				<listitem><simpara>If NFSv2 is in use (not the case if the NFS server is a &ucsUCS;), please set <envar>mail/dovecot/process/dotlock_use_excl</envar><literal> = no</literal>.</simpara></listitem>
				<listitem><simpara>If lockd is not in use (not the case on &ucsUCS; systems) or if even with lockd in use locking error are encountered, set <envar>mail/dovecot/process/lock_method</envar><literal> = dotlock</literal>. This does lower the performance, but solves most locking related errors.</simpara></listitem>
				<listitem><simpara>Dovecot flushes NFS caches when needed if you set <envar>mail/dovecot/process/mail_nfs_storage</envar><literal> = yes</literal>, but unfortunately this doesn't work 100%, so you can get random errors. The same holds for flushing NFS caches after writing index files with <envar>mail/dovecot/process/mail_nfs_index</envar><literal> = yes</literal>.</simpara></listitem>
				<listitem><simpara>The Dovecot documentation has more information on the topic: <xref linkend="dovecot-wiki-clusterfs"/> <xref linkend="dovecot-wiki-nfs"/></simpara></listitem>
			</itemizedlist>
		</para>
	</section>

	<section id="mail::serverconfig::limits">
		<title>Connection limits</title>
		<para>
			In a default &ucsUCS; configuration Dovecot allows 400 concurrent IMAP and POP3 connections each.
			That is enough to serve at least 100 concurrently logged in IMAP users, possibly a lot more.
			How many IMAP connections are opened by a user depends on the clients they use.
			Webmail opens just a few short lived connections.
			Desktop clients keep multiple connections open over a long period of time.
			Mobile clients keep just a few connections open over a long period of time.
			But they tend to never close them, unnecessarily wasting resources.
			The limits exist mainly to resist denial of service attacks that open a lot of connections and create lots of processes.
		</para>
		<para>
			To list the open connections, run:
			<programlisting language="sh">doveadm who</programlisting>
			To display the total amount of open connections, run:
			<programlisting language="sh">doveadm who -1 | wc -l</programlisting>
		</para>
		<para>
			The &ucsUCRV;s <envar>mail/dovecot/limits/*</envar> can be set to modify the limits.
			The process of adapting those variables is only semi automatic, because of their complex interaction.
			For the meaning of each variable refer to the Dovecot documentation: <xref linkend="dovecot-wiki-services"/>
		</para>
		<para>
			Dovecot uses separate processes for login and to access emails.
			The limits for these can be configured separately.
			The maximum number of concurrent connections to a service and the maximum number of processes for a service is also configured separately.
			Setting <envar>mail/dovecot/limits/default_client_limit</envar><literal> = 3000</literal> changes the limit for the maximum number of concurrent connections to the IMAP and POP3 services but does not change the maximum number of processes allowed to run.
			With the &ucsUCS; default settings Dovecot runs in "High-security mode": each connection is served by a separate process.
			The default is to allow only 400 processes, so only 400 connections can be made.
		</para>
		<para>
			To allow 3000 clients to connect to their emails, another &ucsUCRV; has to be set:
			<programlisting language="sh">
ucr set mail/dovecot/limits/default_client_limit=3000
ucr set mail/dovecot/limits/default_process_limit=3000
doveadm reload
			</programlisting>
		</para>
		<para>
			Reading <filename>/var/log/dovecot.info</filename> reveals a warning:
<screen>
config: Warning: service auth { client_limit=2000 } is lower than required under max. load (15000)
config: Warning: service anvil { client_limit=1603 } is lower than required under max. load (12003)
</screen>
			The services <literal>auth</literal> (responsible for login and SSL connections) and <literal>anvil</literal> (responsible for statistics collection) are set to their default limits.
			Although 3000 POP3 and IMAP connections and processes are allowed, the connection limit for the login service is too low.
			Leaving it like this will lead to failed logins.
		</para>
		<para>
			The values are so high, because <literal>default_client_limit</literal> and <literal>default_process_limit</literal> do not only lift limits for IMAP and POP3, but also for other services like <literal>lmtp</literal> and <literal>managesieve-login</literal>.
			Those services can now start more processes that have to be monitored and can theoretically make more authentication requests.
			This increases the number of possible concurrent connections to the <literal>auth</literal> and <literal>anvil</literal> services.
		</para>
		<para>
			The values have to be adapted, using the numbers from the log file:
<programlisting language="sh">
ucr set mail/dovecot/limits/auth/client_limit=15000
ucr set mail/dovecot/limits/anvil/client_limit=12003
doveadm reload
</programlisting>
			Another warning appears in <filename>/var/log/dovecot.info</filename>:
<screen>
master: Warning: fd limit (ulimit -n) is lower than required under max. load (2000 &lt; 15000),…
 because of service auth { client_limit }
</screen>
			The Linux kernel controlled setting <literal>ulimit</literal> setting (limit on the number of files/connections a process is allowed to open) is changed only when the Dovecot service is restarted:
<programlisting language="sh">
invoke-rc.d dovecot restart
</programlisting>
			No more warnings are written to the log file and both IMAP and POP3 servers now accept 3000 client connections each.
		</para>
		<para>
			&ucsUCS; configures Dovecot to run in "High-security mode" by default.
			For installations with 10.000s of users, Dovecot offers the "High-performance mode".
			The performance guide has further details on how to configure it: <biblioref linkend="ucs-performance-guide"/>.
		</para>
	</section>

  </section>

  <section id="mail:clients">
		<title>Configuration of mail clients for the mail server</title>

	<para>
	  The use of IMAP is recommended for using a mail client with the UCS mail server. STARTTLS is
	  used to switch to a TLS-secured connection after an initial negotiation phase when using SMTP
	  (for sending mail) and IMAP (for receiving/synchronizing mail). <emphasis>Password (plain
	  text)</emphasis> should be used in combination with <emphasis>STARTTLS</emphasis> as the
	  authentication method. The method may have a different name depending on the mail client.
	  The following screenshot shows
	  the setup of Mozilla Thunderbird as an example.
	</para>

	<para>
	  <figure id="mail:clients:thunderbird">
		<title>Setup of Mozilla Thunderbird</title>
		<graphic scalefit="1" align="center" width="80%" fileref="illustrations43/thunderbird_en.png"/>
	  </figure>
	</para>
  </section>

  <section id="mail::horde">
	<title>Webmail and administration of e-mail filters with Horde</title>
	<para>
	  UCS integrates a number of applications from the Horde framework for
	  web access to e-mails and web-based administration of server-side e-mail filter
	  rules based on Sieve. Horde can be installed via the Univention App Center (see <xref
	  linkend="software:appcenter"/>).
	</para>
	<section id="mail:Login_and_overview">
	  <title>Login and overview</title>
	  <para>
		The Horde login mask is linked on the system overview page (see <xref
		linkend="central-management-umc:login"/>) under <guimenu>Horde web client</guimenu> and can
		be opened directly at <uri>http://SERVERNAME/horde/</uri>.
	  </para>
	  <para>
		<figure id="horde-login">
		  <title>Login on Horde</title>
		  <graphic scalefit="1" align="center" width="35%" fileref="illustrations43/login_en.png"/>
		  </figure>
	  </para>
	  <para>
		Either the UCS user name or the primary e-mail address can be used as the user name. The
		webmail interface can be used in a number of display modes. The preferred version can be
		selected under <guimenu>Mode</guimenu>. We recommend the use of the dynamic interface for
		standard workstations. The remaining documentation refers to this version. Selecting the
		<guimenu>Language</guimenu> has no effect in many web browsers, as the browser's preferred
		language settings take precedence.
	  </para>
	  <para>
		In the top toolbar there are a number or menu points (e.g., <guimenu>Mail</guimenu> and
		<guimenu>Address Book</guimenu>), which can be used to switch between the individual
		modules.
	  </para>
	  <para>
		The user can personalize Horde by clicking the cog symbol.
	  </para>
	</section>

	<section id="mail:Web-based_mail_access">
	  <title>Web-based mail access</title>
	  <para>
		Horde offers all the standard functions of an e-mail client such as the
		sending, forwarding and deletion of e-mails. E-mails can be sorted in folders
		and are stored in <guimenu>Inbox</guimenu> as standard. A <emphasis>Sent</emphasis>
		folder is created automatically the first time an e-mail is sent.
	  </para>
	  <para>
		<figure id="horde-inbox">
		  <title>Web mail (Inbox)</title>
		  <graphic scalefit="1" width="95%" fileref="illustrations43/inbox_en.png"/>
		  </figure>
	  </para>
	  <para>
		Horde differentiates between two types of deletion: An e-mail deleted with
		<guimenu>Delete</guimenu> is initially moved to the <emphasis>Trash</emphasis> folder. From
		there, it can be moved into any other folder as long as the trash can has not been emptied
		with <guimenu>Empty</guimenu>.
	  </para>
	</section>

	<section id="mail:Address_book">
	  <title>Address book</title>
	  <para>
		This module is used to administrate e-mail addresses and additional contact
		information. The information compiled here are saved in Horde's own SQL
		database.
	  </para>
	  <figure id="horde-address">
		<title>Address book for webmail</title>
		<graphic scalefit="1" width="100%" fileref="illustrations43/addressbook_en.png"/>
	  </figure>
	  <para>
		Contact information found using the simple or advanced search can then be
		copied into individual address books and edited there. New contacts can be
		entered via the <guimenu>New Contact</guimenu> menu item. Personal address books
		can also be created via <guimenu>My Address Books</guimenu>.
	  </para>
	  <para>
		The <guimenu>Browse</guimenu> menu item can be used to display the contents of
		address books. The lists can be sorted alphabetically by clicking on the
		preferred column title (surname, first name, etc.). Clicking on the magnifying
		glass in the header of the respective address book (directly next to the name
		of the address book) opens a search field that can be used easily to search
		within the open address book. Individual addresses in a list can be marked
		with an X for subsequent use, i.e., to export them as a file in a certain file
		format or to copy them into another address book.
	  </para>
	</section>

	<section id="mail::horde::filter">
	  <title>E-mail filters</title>
	  <para>
		Dovecot supports server-side filter scripts written in an individual
		script language called Sieve. The filter module allows the generation
		of these filter scripts. They apply generally and thus also apply for
		users accessing their inboxes via a standard mail client.
	  </para>
	  <figure id="horde-filter">
		<title>Filter management in Horde</title>
		<graphic scalefit="1" width="100%" fileref="illustrations43/filter_en.png"/>
	  </figure>
	  <para>
		Filters can be edited and expanded
		under <guimenu>Mail &ar; Filters</guimenu>. The filters are applied to incoming e-mails
		in the consecutively numbered order. Their position can be altered either
		using the arrows to the right or by entering a number in
		the <command>Move</command> column directly. Individual filter rules can be
		switched on and off in the <command>Enabled</command> column.
	  </para>
	  <para>
		The <guimenu>Spam</guimenu> filter can be used user-specifically to set which Spam
		threshold should apply. The specified <guimenu>Spam Level</guimenu> is the
		SpamAssassin threshold. An e-mail which returns this value will be sent to
		the specified folder.
	  </para>
	  <para>
		A <guimenu>Vacation</guimenu> filter can be used to specify a period in which
		incoming e-mails are automatically replied to with an answer e-mail by the
		mail server. The text and subject of the e-mail can be selected as required.
	  </para>
	  <para>
		<guimenu>New Rule</guimenu> can be used to create new rules, e.g., for
		the automatic sorting of incoming mails into topic-specific mail folders.
	  </para>
	  <para>
		Clicking on <guimenu>Script</guimenu> displays the source text of the generated
		Sieve script.
	  </para>
	</section>
  </section>
</chapter>
<!-- vim:set ts=2 sw=2 tw=100 noet ft=docbk:-->
